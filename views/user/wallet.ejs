<%- include('../../views/partials/user/profileHeader.ejs') %>

<!-- Styles -->
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f0f2f5;
    }
    .card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 24px;
        margin-bottom: 24px;
    }
    .card-title {
        font-size: 28px;
        font-weight: bold;
        margin-bottom: 12px;
        color: #2c3e50;
    }
    .card-description {
        color: #7f8c8d;
        margin-bottom: 20px;
    }
    .balance {
        font-size: 42px;
        font-weight: bold;
        margin-bottom: 24px;
        color: #27ae60;
    }
    button {
        background-color: #3498db;
        color: #fff;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s ease;
    }
    button:hover {
        background-color: #2980b9;
    }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        text-align: left;
        padding: 14px;
        border-bottom: 1px solid #ecf0f1;
    }
    th {
        background-color: #f8f9fa;
        font-weight: 600;
        color: #34495e;
    }
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        backdrop-filter: blur(5px);
    }
    .modal-content {
        background-color: #fff;
        margin: 10% auto;
        padding: 30px;
        border-radius: 12px;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        animation: modalFadeIn 0.3s;
    }
    @keyframes modalFadeIn {
        from {opacity: 0; transform: translateY(-50px);}
        to {opacity: 1; transform: translateY(0);}
    }
    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.3s ease;
    }
    .close:hover {
        color: #2c3e50;
    }
    .credit {
        color: #27ae60;
    }
    .debit {
        color: #c0392b;
    }
    #amountInput {
        width: 100%;
        padding: 12px;
        margin: 16px 0;
        border: 2px solid #bdc3c7;
        border-radius: 6px;
        font-size: 18px;
        transition: border-color 0.3s ease;
    }
    #amountInput:focus {
        outline: none;
        border-color: #3498db;
    }
    .modal-title {
        font-size: 24px;
        color: #2c3e50;
        margin-bottom: 12px;
    }
    .modal-description {
        color: #7f8c8d;
        margin-bottom: 20px;
    }
</style>

<!-- Toastr and SweetAlert Libraries -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- SweetAlert Success/Error Messages -->
<% if (successMessage && successMessage.length) { %>
    <script>
        Swal.fire({
            icon: 'success',
            title: 'Success',
            text: '<%= successMessage %>',
            confirmButtonText: 'OK'
        });
    </script>
<% } %>
<% if (errorMessage && errorMessage.length) { %>
    <script>
        Swal.fire({
            icon: 'error',
            title: 'Error',
            text: '<%= errorMessage %>',
            confirmButtonText: 'OK'
        });
    </script>
<% } %>

<!-- Wallet Balance and Add Money Button -->
<div class="card mt-5">
    <h2 class="card-title">Your Wallet</h2>
    <p class="card-description">Manage your funds and view transaction history</p>
    <div class="balance" id="balance">Balance: ₹
            <% if (wallet.balance > 0) { %>
                <%= wallet.balance.toFixed(2) %>
            <% } else { %>
                0
            <% } %>
        </div>
        <button id="addMoneyBtn" type="button">Add Money</button>

        </div>
</div>

<!-- Transaction History Display -->
<div class="card">
    <h2 class="card-title">Transaction History</h2>
    <table>
        <thead>
            <tr>
                <th>&nbsp;&nbsp;&nbsp;&nbsp;Date   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Time</th>
                <th>Type</th>
                <th>Amount</th>
            </tr>
        </thead>
        <tbody>
            <% for (let i = 0; i < wallet.transactions.length; i++) { %>
                <tr>
                    <td><%= wallet.transactions[i].transaction_date.toLocaleString() %></td>
                    <td class="<%= wallet.transactions[i].transaction_type %>"><%= wallet.transactions[i].transaction_type %></td>
                    <td>₹<%= wallet.transactions[i].amount.toFixed(2) %></td>
                </tr>
            <% } %>
        </tbody>
    </table>
    <p class="card-description" id="transactionCount">Showing <%= wallet.length %> recent transactions</p>
</div>

<!-- Modal for Adding Money -->
<div id="addMoneyModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2 class="modal-title">Add Money to Wallet</h2>
        <p class="modal-description">Enter the amount you want to add to your wallet.</p>
        <form action="/userwallet" method="post">
            <input type="number" id="amountInput" name="amount" placeholder="Enter amount" min="0" step="1">
            <button id="confirmAddMoney" type="submit">Add to Wallet</button>
        </form>  
    </div>
</div>

<!-- JavaScript for Modal, Toastr, and Toast Notifications -->
<script>
    const addMoneyBtn = document.getElementById('addMoneyBtn');
    const modal = document.getElementById('addMoneyModal');
    const closeBtn = document.getElementsByClassName('close')[0];
    const balanceElement = document.getElementById('balance');
    const transactionCount = document.getElementById('transactionCount');

    // Toastr configuration
    toastr.options = {
        "closeButton": true,
        "progressBar": true,
        "positionClass": "toast-bottom-right",
        "timeOut": "3000"
    };

    // Function to update balance display
    function updateBalance(newBalance) {
        balanceElement.textContent = `Balance: $${newBalance.toFixed(2)}`;
    }

    // Open and close modal
    addMoneyBtn.onclick = () => { modal.style.display = "block"; };
    closeBtn.onclick = () => { modal.style.display = "none"; };
    window.onclick = event => { if (event.target == modal) modal.style.display = "none"; };
</script>

<%- include('../../views/partials/user/profileFooter.ejs') %>
